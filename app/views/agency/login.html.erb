<!DOCTYPE html>
<html lang="en">
	<head>
		<title>微行  代理平台</title>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="/css/bootstrap.min.css" />
		<link rel="stylesheet" href="/css/font-awesome.css" />
		<link rel="stylesheet" href="/css/unicorn-login.css" />
		<script type="text/javascript" src="/js/respond.min.js"></script>
		<style>
			.help-inline {
				color: #999999;
				font-size: 12px;
				margin-right: 20px
			}
		</style>
	</head>
	<body>
		<div id="container">
			<div id="logo">
				<img src="/images/agency/logo2.png" alt="" />
			</div>
			<div id="user">
				
				<div class="text">
					<h4>欢迎回来,<span class="user_name"></span></h4>
				</div>
			</div>
			<div id="loginbox">
				<form id="loginform" action="#">
					<p>
						请输入账号和密码登入.
					</p>
					<div class="input-group input-sm" id="username_div">
						<span class="input-group-addon"><i class="fa fa-user"></i></span>
						<input class="form-control" type="text" name="username" id="username" autocomplete="off" placeholder="账号" />
					</div>
					<div class="errorplace">

					</div>
					<div class="input-group">
						<span class="input-group-addon"><i class="fa fa-lock"></i></span>
						<input class="form-control" type="password" name="password" id="password" placeholder="密码" />
					</div>
					<div class="errorplace" id="error2">

					</div>
					<div class="form-actions clearfix">
						<div class="pull-left">
							<a href="#registerform" class="flip-link to-register blue">注册新账号</a>
						</div>
						<div class="pull-right">
							<a href="#recoverform" class="flip-link to-recover grey">忘记密码?</a>
						</div>
						<input type="submit" class="btn btn-block btn-primary btn-default" value="登录" />
					</div>
					<div class="footer-login">
						<div class="pull-right text">
							<img src="/images/agency/powered.png" />
						</div>

					</div>

				</form>
				<form id="recoverform" action="#">
					<div id="title"><p>
						输入您注册的邮件地址，系统会发送邮件指引您恢复密码.
					</p>
					</div>
					<div class="input-group" id="resetgroup">
						<span class="input-group-addon"><i class="fa fa-envelope"></i></span>
						<input id="emailreset" name="emailreset" class="form-control" type="text" placeholder="邮件地址" />
					</div>
					<div id="error_emailreset" style="display:block;width:130px;height:30px;position:absolute;left:410px;bottom:102px;text-align: left"></div>

					<div class="form-actions clearfix">
						<div class="pull-left">
							<a href="#loginform" class="grey flip-link to-login">返回登录</a>
						</div>
						<div class="pull-right">
							<a href="#registerform" class="blue flip-link to-register">注册新账号</a>
						</div>
						<input type="submit" id="resetbtn" class="btn btn-block btn-inverse" value="恢复" />
					</div>
				</form>
				<form id="registerform" action="#">
					<p>
						请输入注册必须的信息:
					</p>
					<div class="input-group">
						<span class="input-group-addon"><i class="fa fa-user"></i></span>
						<input id="regusername"  name="regusername" class="form-control" type="text" placeholder="账号" size="10	" />
					</div>
					<div id="error_username" style="display:block;width:120px;height:30px;position:absolute;left:410px;bottom:199px;text-align: left"></div>
					<div class="input-group">
						<span class="input-group-addon"><i class="fa fa-lock"></i></span>
						<input id="regpassword" name="regpassword" class="form-control" type="password" placeholder="选择一个密码" />
					</div>
					<div id="error_password" style="display:block;width:120px;height:30px;position:absolute;left:410px;bottom:160px;text-align: left"></div>
					<div class="input-group">
						<span class="input-group-addon"><i class="fa fa-lock"></i></span>
						<input id="password_confirm" name="password_confirm" class="form-control" type="password" placeholder="确认您的密码" />
					</div>
					<div id="error_password_conf" style="display:block;width:130px;height:30px;position:absolute;left:410px;bottom:120px;text-align: left"></div>
					<div class="input-group">
						<span class="input-group-addon"><i class="fa fa-envelope"></i></span>
						<input id="email" name="email" class="form-control" type="text" placeholder="您的邮件地址" />
					</div>
					<div id="error_email" style="display:block;width:130px;height:30px;position:absolute;left:410px;bottom:82px;text-align: left"></div>

					<div class="form-actions clearfix">
						<div class="pull-left">
							<a href="#loginform" class="grey flip-link to-login">返回登录</a>
						</div>
						<div class="pull-right">
							<a href="#recoverform" class="grey flip-link to-recover">忘记密码?</a>
						</div>
						<input type="submit" class="btn btn-block btn-success" value="注册" />
					</div>
				</form>
			</div>

			<script src="/js/jquery.min.js"></script>
			<script type="text/javascript" scr="/js/jquery.validate.js"></script>
			<script src="/js/jquery-ui.custom.min.js"></script>
			<script src="/js/unicorn.login.js"></script>
			<script src="/js/jquery.validate.js"></script>
			<script src="/js/jquery.form.min.js"></script>
			<%= javascript_include_tag "jquery-ujs.js" %>
			<%= javascript_include_tag "notify-custom.js" %>
			<script>
				//var loginbox = $('#loginbox');
				//var userbox = $('#user');
				function showRequest(formData, jqForm, options) {
					// formData is an array; here we use $.param to convert it to a string to display it
					// but the form plugin does this for you automatically when it submits the data
					var queryString = $.param(formData);

					// jqForm is a jQuery object encapsulating the form element.  To access the
					// DOM element for the form do this:
					// var formElement = jqForm[0];

					//alert('About to submit: \n\n' + queryString);

					// here we could return false to prevent the form from being submitted;
					// returning anything other than false will allow the form submit to continue
					return true;
				}


				$(document).ready(function() {
					var options = {
						target : '#output1', // target element(s) to be updated with server response
						beforeSubmit : showRequest, // pre-submit callback
						success : showResponse, // post-submit callback

						// other available options:
						url : '/agency/usercheck', // override for form's 'action' attribute
						type : 'post', // 'get' or 'post', override for form's 'method' attribute
						dataType : 'script', // 'xml', 'script', or 'json' (expected server response type)
						clearForm : false // clear all form fields after successful submit
						//resetForm: true        // reset the form after successful submit
					};

					var optionsreg = {
						beforeSubmit : showRequest, // pre-submit callback
						success : showResponse, // post-submit callback

						// other available options:
						url : '/agency/register', // override for form's 'action' attribute
						type : 'post', // 'get' or 'post', override for form's 'method' attribute
						dataType : 'script', // 'xml', 'script', or 'json' (expected server response type)
						clearForm : false // clear all form fields after successful submit
						//resetForm: true        // reset the form after successful submit
					};

					var optionsrecover = {
						beforeSubmit : showRequest, // pre-submit callback
						success : showResponse, // post-submit callback

						// other available options:
						url : '/users/resetpassword', // override for form's 'action' attribute
						type : 'post', // 'get' or 'post', override for form's 'method' attribute
						dataType : 'script', // 'xml', 'script', or 'json' (expected server response type)
						clearForm : false // clear all form fields after successful submit
						//resetForm: true        // reset the form after successful submit
					};

					// bind form using 'ajaxForm'
					$('#loginform').ajaxForm(options);
					$('#registerform').ajaxForm(optionsreg);
					$('#recoverform').ajaxForm(optionsrecover);

				});

				function showResponse(responseText, statusText, xhr, $form) {
					// for normal html responses, the first argument to the success callback
					// is the XMLHttpRequest object's responseText property

					// if the ajaxForm method was passed an Options Object with the dataType
					// property set to 'xml' then the first argument to the success callback
					// is the XMLHttpRequest object's responseXML property

					// if the ajaxForm method was passed an Options Object with the dataType
					// property set to 'json' then the first argument to the success callback
					// is the json data object returned by the server

					//alert('status: ' + statusText + '\n\nresponseText: \n' + responseText + '\n\nThe output div should have already been updated with the responseText.');
				}


				$("#registerform").validate({
					focusInvalid : true,
					focusCleanup : false,
					onkeyup : false,
					rules : {
						regusername : {
							required : true,
							remote : {
								url : "/agency/reg_check",
								type : "post"
							}

						},
						regpassword : {
							required : true,
							minlength : 6
						},
						password_confirm : {
							required : true,
							minlength : 6,
							equalTo : "#regpassword"
						},
						email : {
							required : true,
							email : true,
							remote : {
								url : "/agency/email_check",
								type : "post"
							}
						}

					},
					messages : {
						regusername : {
							required : "用户名不能为空",
							remote : "用户名已经存在"
						},
						regpassword : {
							required : "密码不能为空",
							minlength : "密码至少为6位"
						},
						password_confirm : {
							required : "请确认密码",
							minlength : "密码至少为6位",
							equalTo : "两次输入密码不一致"
						},

						email : {
							required : "请输入您的邮件地址",
							email : "请输入有效邮件地址",
							remote : "该邮件地址已被使用"
						},
					},
					errorPlacement : function(error, element) {
						error.appendTo(element.parent().next());
					},

					/*submitHandler : function(form) {

					 $("#loginform").ajaxSubmit();
					 return false;
					 },*/

					errorClass : "help-inline",
					errorElement : "span",
				});

				$("#recoverform").validate({
					focusInvalid : true,
					focusCleanup : false,
					onkeyup : false,
					rules : {

						emailreset : {
							required : true,
							email : true,
							remote : {
								url : "/agency/email_check",
								type : "post"
							}
						}

					},
					messages : {

						emailreset : {
							required : "请输入您的邮件地址",
							email : "请输入有效邮件地址",
							remote : "该邮件地址没有注册"
						}
					},
					errorPlacement : function(error, element) {
						error.appendTo(element.parent().next());
					},

					/*submitHandler : function(form) {

					 $("#loginform").ajaxSubmit();
					 return false;
					 },*/

					errorClass : "help-inline",
					errorElement : "span",
				});

				$("#loginform").validate({
					focusInvalid : true,
					focusCleanup : true,
					rules : {
						username : "required",
						password : "required"
					},
					messages : {
						username : "用户名不能为空",
						password : "密码不能为空"
					},
					errorPlacement : function(error, element) {
						error.appendTo($("#error2"));
					},

					/*submitHandler : function(form) {

					 $("#loginform").ajaxSubmit();
					 return false;
					 },*/

					errorClass : "help-inline",
					errorElement : "span",
				});

				function loginsucc() {
					var thisForm = $("#loginform");
					var userinput = $('#username');
					loginbox.animate({
						'top' : '+=100px',
						'opacity' : '0'
					}, 250, function() {
						$('.user_name').text(userinput.val());
						userbox.animate({
							'top' : "+=175px",
							'opacity' : '1'
						}, 250, function() {
							setTimeout(function() {
								location.href = '/agency/index'
							}, 600);
						});
					});
					return true;

				}

				function regsuccess() {
					switch_container(login, recover_register, 265);
					str = "注册成功,请查收注册邮箱中的激活邮件,激活后登录.";
					$("#username_div").notify(str, {
						className : "success",
						arrowShow : false,
						position : "top",
						autoHideDelay : 4000
					});

				}

				function setUserNotActive() {
					str = "您的帐号没有被激活，请查看邮件激活。";
					$("#username").notify(str, {
						className : "warn",
						arrowShow : false,
						position : "top",
						autoHideDelay : 4000
					});

				}
				
					function userpasswrong() {
					str = "您的帐号和密码不匹配，或者用户不存在。";
					$("#username").notify(str, {
						className : "error",
						arrowShow : false,
						position : "top",
						autoHideDelay : 4000
					});

				}
				
				

				function mailsent() {
					str = "<p>一封重置密码指引邮件已经发送到您的邮箱，请查收</p>";
					$("#emailreset").attr("disabled","disabled");
					$("#resetbtn").addClass("disabled");
					$("#title").html(str);
				}
				
				
			</script>
	</body>
</html>
