<!DOCTYPE html>
<html lang="en">
	<head>
		<title>微行微系统</title>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="/css/bootstrap.min.css" />
		<link rel="stylesheet" href="/css/font-awesome.css" />
		<link rel="stylesheet" href="/css/jquery.jscrollpane.css" />
		<link rel="stylesheet" href="/css/slick.css" />
		<link rel="stylesheet" href="/css/jquery-ui.css" />
		<link rel="stylesheet" href="/css/unicorn.css" />
		<link rel="stylesheet" href="/css/jquery.gritter.css" />
		<link rel="stylesheet" href="/css/bootstrap-select.min.css" />
		<link rel="stylesheet" href="/css/slickstyle.css" />
		<link rel="stylesheet" href="/css/jquery.fileupload.css" />
		<link rel="stylesheet" href="/css/bootstrap-editable.css" />
		<link rel="stylesheet" href="/css/agency-mcard.css" />
		<!--[if lt IE 9]>
		<script type="text/javascript" src="/js/respond.min.js"></script>
		<![endif]-->
		<style>
			
		</style>

	</head>
	<body data-color="grey" class="flat">
		<div id="wrapper" style="">
			<div id="header">
				<h1><a href="/agency/index">微行</a></h1>
				<a id="menu-trigger" href="#"><i class="fa fa-bars"></i></a>
			</div>

			<div id="user-nav">
				<ul class="btn-group">
					<li class="btn">
						<a title="" href="/agency/logout"><i class="fa fa-share"></i> <span class="text">登出</span></a>
					</li>
				</ul>
			</div>

			<div id="switcher">
				<div id="switcher-inner">
					<h3>标题栏颜色</h3>
					<h4>颜色</h4>
					<p id="color-style">
						<a data-color="orange" title="Orange" class="button-square orange-switcher" href="#"></a>
						<a data-color="turquoise" title="Turquoise" class="button-square turquoise-switcher" href="#"></a>
						<a data-color="blue" title="Blue" class="button-square blue-switcher" href="#"></a>
						<a data-color="green" title="Green" class="button-square green-switcher" href="#"></a>
						<a data-color="red" title="Red" class="button-square red-switcher" href="#"></a>
						<a data-color="purple" title="Purple" class="button-square purple-switcher" href="#"></a>
						<a href="#" data-color="grey" title="Grey" class="button-square grey-switcher"></a>
					</p>
					<!--
					<h4>Background Patterns</h4>
					<h5>for boxed version</h5>
					<p id="pattern-switch">
					<a data-pattern="pattern1" style="background-image:url('assets/img/patterns/pattern1.png');" class="button-square" href="#"></a>
					<a data-pattern="pattern2" style="background-image:url('assets/img/patterns/pattern2.png');" class="button-square" href="#"></a>
					<a data-pattern="pattern3" style="background-image:url('assets/img/patterns/pattern3.png');" class="button-square" href="#"></a>
					<a data-pattern="pattern4" style="background-image:url('assets/img/patterns/pattern4.png');" class="button-square" href="#"></a>
					<a data-pattern="pattern5" style="background-image:url('assets/img/patterns/pattern5.png');" class="button-square" href="#"></a>
					<a data-pattern="pattern6" style="background-image:url('assets/img/patterns/pattern6.png');" class="button-square" href="#"></a>
					<a data-pattern="pattern7" style="background-image:url('assets/img/patterns/pattern7.png');" class="button-square" href="#"></a>
					<a data-pattern="pattern8" style="background-image:url('assets/img/patterns/pattern8.png');" class="button-square" href="#"></a>
					</p>-->

				</div>
				<div id="switcher-button">
					<i class="fa fa-cogs"></i>
				</div>
			</div>

			<div id="sidebar">

				<ul>
					<li>
						<a href="index.html"><i class="fa fa-home"></i> <span>账户首页</span></a>
					</li>
					<li class="submenu active open">
						<a href="#"><i class="fa fa-credit-card"></i> <span>汇员卡</span> <i class="arrow fa fa-chevron-right"></i></a>
						<ul>
							<li class="active">
								<a href="/agency/mcard">客户管理</a>
							</li>
							<li>
								<a href="/agency/cardguide">操作指南</a>
							</li>
						</ul>
					</li>
					<li class="submenu">
						<a href="#"><i class="fa fa-th-list"></i> <span>微行秀</span> <i class="arrow fa fa-chevron-right"></i></a>
						<ul>
							<li>
								<a href="/agency/wxshow">客户管理</a>
							</li>
							<li>
								<a href="/agency/wxshowguide">操作指南</a>
							</li>
						</ul>
					</li>
					<li>
						<a href="/agency/wxschool"><i class="fa fa-th"></i> <span>家校通</span></a>
					</li>
					<li>
						<a href="/agency/wxshop"><i class="fa fa-th-list"></i> <span>朋友店</span></a>
					</li>
					<li class="submenu">
						<a href="#"><i class="fa fa-file"></i> <span>微企管</span> <i class="arrow fa fa-chevron-right"></i></a>
						<ul>
							<li>
								<a href="/agency/voa">客户管理</a>
							</li>
							<li>
								<a href="/agency/voaguide">操作指南</a>
							</li>
						</ul>
					</li>
					<li>
						<a href="/agency/credit"><i class="fa fa-cny"></i> <span>充值&点数</span></a>
					</li>

				</ul>

			</div>

			<div id="content">
				<div id="content-header" class="mini">
					<h1>汇员卡</h1>

				</div>

				<div class="container-fluid">

					<div class="row">
						<div class="col-xs-12">
							<button class="btn btn-dark-blue" onclick="createuser()">
								<i class="fa fa-plus-circle"></i> &nbsp;新商户
							</button>
						</div>
					</div>

					<div class="row">
						<div class="col-xs-12">
							<div class="widget-box">
								<div class="widget-title">
									<span class="icon"> <i class="fa fa-th"></i> </span>
									<h5>客户管理</h5>

								</div>
								<div class="widget-content nopadding">
									<table class="table table-bordered data-table" id="usertable">
										<thead>
											<tr>
												<th>id</th>
												<th>客户名称</th>
												<th>子域名</th>
												<th>状态</th>
												<th>上线时间</th>
												<th>到期时间</th>
												<th>操作</th>
											</tr>
										</thead>
										<tbody id="dtable">
											<% @shops.each do |shop| %>
											<%if shop.online==0%>
											<tr class="offlinecol" id="row<%= shop.id%>">
												<%else%>
											<tr class="onlinecol" id="row<%= shop.id%>">
												<%end%>
												<td><%= shop.id%></td>
												<td class="col-sm-2 col-md-2 col-lg-2" style="text-align:center"><%= shop.name%></td>
												<td class="col-sm-2 col-md-2 col-lg-2" style="text-align:center"><%= shop.shopurl%></td>
												<td class="col-sm-1 col-md-1 col-lg-1" style="text-align:center" class="taskStatus"><span class="status"><%= shop.status%></span></td>
												<td class="col-sm-2 col-md-2 col-lg-2" style="text-align:center"><%= shop.created_at.to_s[0,10]%></td>
												<td class="col-sm-2 col-md-2 col-lg-2" class="centercol" style="text-align:center"><%= shop.exprieddate.to_s[0,10]%></td>
												<td class="col-sm-3 col-md-3 col-lg-3" style="text-align: center" rid="<%= shop.id%>" id="rec<%= shop.id%>"> <%if shop.online==0%>
												<button class="btn btn-success btn-sm" onclick="online(this);return false;">
													启动
												</button> <%else%>
												<button class="btn btn-danger btn-sm" onclick="online(this);return false;">
													停止
												</button> <%end%>
												<button class="btn btn-dark-blue btn-sm" onclick="setTemplate(this);return false;" id="shoppage<%= shop.id%>" templateid="<%= shop.usertemplate_id%>">
													页面
												</button>
												<button class="btn btn-dark-blue btn-sm" onclick="setCard(this);return false;" id="shopcard<%= shop.id%>" cardid="<%= shop.membercard_id%>">
													卡片
												</button> </br>
												<button class="btn btn-dark-blue btn-sm" onclick="setConnect(this);return false;">
													连接
												</button>
												<button class="btn btn-dark-blue btn-sm" onclick="setAccount(this);return false;">
													账户
												</button>
												<button class="btn btn-dark-red btn-sm del-modal"  onclick="delconfirm(this);return false;">
													删除
												</button></td>
											</tr>
											<% end %>
										</tbody>
									</table>
								</div>

							</div>

						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div id="footer" class="col-xs-12">
					2013 - 2014 &copy; 微行微系统
				</div>
			</div>

			<div id="offline-dialog" title="确认停止">
				停止服务，将使该商户的应用<b>无法访问</b>，请确认。
			</div>

			<div id="online-dialog" title="确认启动">
				启动服务商户，将使商户的应用<b>开始运行</b>，请确认。
			</div>

			<div id="delete-dialog" title="确认">
				删除商户，将使商户信息<b>完全消失，无法恢复</b>，请确认。
			</div>

			<div id="charge-dialog" title="续费确认">
				充值<span id="month-span">1</span>个月需要<b><span id="point-span">1</span></b>点数，请确认。
			</div>

			<div id="addmenu-dialog" title="菜单内容" style="display:none">
				<table class="table table-bordered table-striped table-hover">
					<tbody>
						<tr>
							<td style="width:30%">标题 </td>
							<td>
							<input class="inputfield" type="text" id="menutitle">
							</td>
						</tr>
						<tr>
							<td style="width:30%">链接 </td>
							<td>
							<input class="inputfield" type="text" id="menuurl">
							</td>
						</tr>
					</tbody>
				</table>
			</div>

			<div id="changemenu-dialog" title="菜单内容" style="display:none">
				<table class="table table-bordered table-striped table-hover">
					<tbody>
						<tr>
							<td style="width:30%">标题 </td>
							<td>
							<input class="inputfield" type="text" id="menutitle_c">
							</td>
						</tr>
						<tr>
							<td style="width:30%">链接 </td>
							<td>
							<input class="inputfield" type="text" id="menuurl_c">
							</td>
						</tr>
					</tbody>
				</table>
				<b>本菜单如果存在子菜单 则此处的链接无效</b>
			</div>

			<div id="addmenu2-dialog" title="二级菜单" style="display:none">
				<table class="table table-bordered table-striped table-hover">
					<tbody>
						<tr>
							<td style="width:30%">上级 </td>
							<td><select class="form-control" id="menuselect"></select></td>
						</tr>
						<tr>
							<td style="width:30%">标题 </td>
							<td>
							<input class="inputfield" type="text" id="menutitle2">
							</td>
						</tr>
						<tr>
							<td style="width:30%">链接 </td>
							<td>
							<input class="inputfield" type="text" id="menuurl2">
							</td>
						</tr>
					</tbody>
				</table>
			</div>

			<div id="new-dialog" title="建立新商户">
				<form class="form-horizontal" id="newshopform">
					<div class="row">
						<div class="col-lg-10 col-sm-10 col-md-10 form-group">
							<label class="control-label"  for="inputcardno" style="font-size: 14px">商户名</label>
							<input  class="form-control input-sm inputfield" id="shopname" name="shopname" placeholder="商户名" type="text"/>
						</div>

					</div>
					<div class="row">
						<div class="col-lg-10 col-sm-10 col-md-10 form-group">
							<label class="control-label" for="inputphone" style="font-size: 14px">用户类型</label>

							<div class="controls">
								<select id="createtype" class="selectpicker inputfield">
									<option value="普通用户">普通用户</option>
									<option value="试用用户">试用用户</option>
								</select>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-lg-10 col-sm-10 col-md-10 form-group">
							<label class="control-label"  for="inputcardno" style="font-size: 14px">子域名</label>
							<input  class="form-control input-sm inputfield" id="shopurl" placeholder="子域名" type="text"/>
						</div>

					</div>
				</form>
			</div>

			<div id="template-dialog">
				<div>
					<div class="multiple-items" style="display:block;width:300px;height:400px;" id="templates">
						<%@templates.each_with_index do |template,index|%>
						<div class="image templ" id="temp<%= template.id%>" tid="<%= template.id%>" index="<%= index%>"><img data-lazy="<%= template.preview.url(:medium)%>"/>
							<div style="text-align: center;font-size:16px;margin-top: 10px">
								<b><%= template.name%></b>
							</div>
						</div>

						<%end%>
					</div>
					<div style="text-align: center;font-size:16px">
						<button class="btn btn-primary" style="width:70%" onclick="savetemplate()">
							确定
						</button>
					</div>

				</div>
			</div>

			<div id="card-dialog" style="overflow: hidden">
				<div>
					<div class="multiple-items" style="display:block;width:300px;height:180px" id="cards">
						<%@membercards.each_with_index do |card,index|%>
						<div class="image cards" id="card<%= card.id%>" cid="<%= card.id%>" index="<%= index%>"><img data-lazy="<%= card.pic.url(:medium)%>"/>
							<div style="text-align: center;font-size:16px;margin-top: 10px">
								<b><%= card.name%></b>
							</div>
						</div>

						<%end%>
					</div>
					<div style="text-align: center;font-size:16px">
						<button class="btn btn-primary" style="width:70%" onclick="savecard()">
							确定
						</button>
					</div>

				</div>
			</div>

			<div id="connect-dialog" style="overflow: hidden">
				<div id="connect-inner">

				</div>
			</div>

			<div id="account-dialog" style="overflow: hidden">
				<div id="account-inner">

				</div>
			</div>

	</body>

	<script src="/js/jquery.min.js"></script>
	<script src="/js/bootstrap.min.js"></script>
	<script src="/js/jquery-ui.custom.js"></script>


	<script src="/js/jquery.nicescroll.min.js"></script>
	<script src="/js/agency.js"></script>
	<script src="/js/agency-mcard.js"></script>
	<script src="/js/jquery.dataTables.min.js"></script>
	<script src="/js/jquery.gritter.min.js"></script>
	<script src="/js/bootstrap-select.min.js"></script>
	<script src="/js/yaya-template.js"></script>
	<script src="/js/slick.js"></script>
	<script src="/js/jquery-ujs.js"></script>

	<script src="/js/jquery.ui.widget.js"></script>
	<script src="/js/jquery.iframe-transport.js"></script>
	<script src="/js/jquery.fileupload.js"></script>
	<script src="/js/jquery.xdr-transport.js"></script>
	<script src="/js/bootstrap-editable.js"></script>
	<script src="/js/bootstrap.file-input.js"></script>
	<script src="/js/datatabelext.js"></script>
	
	<script type="text/template" id="shoptemplate">
		{$
		<td>{%sid%}</td>
		<td class="col-sm-2 col-md-2 col-lg-2" style="text-align: center">{%sname%}</td>
		<td class="col-sm-2 col-md-2 col-lg-2" style="text-align: center">{%surl%}</td>
		<td class="col-sm-1 col-md-1 col-lg-1" style="text-align: center" class="taskStatus"><span class="status">停止中</span></td>
		<td class="col-sm-2 col-md-2 col-lg-2" style="text-align: center">{%startdate%}</td>
		<td class="col-sm-2 col-md-2 col-lg-2"class="centercol"  style="text-align: center">{%expdate%}</td>
		<td class="col-sm-3 col-md-3 col-lg-3 " style="text-align: center" rid="{%sid%}" id="rec{%sid%}">
		<button class="btn btn-success btn-sm" onclick="online(this);return false;">
		启动
		</button>

		<button class="btn btn-dark-blue btn-sm" onclick="setTemplate(this);return false;" id="shoppage{%sid%}" templateid="{%templateid%}">
		页面
		</button>
		<button class="btn btn-dark-blue btn-sm" onclick="setCard(this);return false;" id="shopcard{%sid%}" cardid="{%membercardid%}">
		卡片
		</button> </br>

		<button class="btn btn-dark-blue btn-sm" onclick="setConnect(this);return false;">
		连接
		</button>

		<button class="btn btn-dark-blue btn-sm" onclick="setAccount(this);return false;">
		账户
		</button>

		<button class="btn btn-dark-red btn-sm del-modal" onclick="delconfirm(this);return false">
		删除
		</button></td>
		$}
	</script>

	<script type="text/template" id="connect-template">
		{$
		<div id="connect-inner">
		<div id="connect-sid"  id="connectsid" style="display: none">{%sid%}</div>	
		<div class="widget-box">
		<div class="widget-title">
		<h5>连接参数</h5>
		</div>
		<div class="widget-content">
		<table class="table table-bordered table-striped table-hover">

		<tbody>
		<tr>
		<td>
		URL
		</td>
		<td>
		http://www.weexing.com/wx/{%wxurl%}
		</td>

		</tr>
		<tr>
		<td>
		Token
		</td>
		<td>
		{%wxtoken%}
		</td>
		</tr>
		<tr>
		<td>
		Appid
		</td>
		<td>
		<div id="appid">{%appid%}</div>
		</td>
		</tr>
		<tr>
		<td>
		AppSecret
		</td>
		<td>
		<div id="appsec">{%appsec%}</div>
		</td>
		</tr>
		</tbody>
		</table>
		</div>
		</div>

		<div class="widget-box">
		<div class="widget-title">
		<h5>微信菜单设置</h5>
		</div>
		<div class="widget-content">
		<table class="table table-bordered table-striped table-hover">

		<tbody>
		<tr>
		<td>
		微信普通账号菜单
		</td>
		<td>
		http://www.weexing.com/weixin
		</td>

		</tr>
		<tr>
		<td>
		微信认证账号菜单
		</td>
		<td>
		http://www.weexing.com/weixing
		</td>
		</tr>
		</tbody>
		</table>
		<div class="table-bordered menucontainer">
		<div class="addfirstmenu"><button class="btn btn-primary" onclick="addmenu()"><span class="glyphicon glyphicon-plus"></span>一级菜单</button><br><button onclick="addmenu2()" class="btn btn-primary"><span class="glyphicon glyphicon-plus"></span>二级菜单</button></div>
		<div id="menuset" level1="0" class="menuframe">
		</div>
		</div>

		<div class="row">
		<div class="pull-right" style="text-align: right;">
		<button class="btn btn-default" onclick="savemenu();return false;"><span class="glyphicon glyphicon-floppy-save">&nbsp;保存</button>
		<button class="btn btn-success" onclick="pubmenu();return false;"><span class="glyphicon glyphicon-send">&nbsp;发布</button>
		</div>
		</div>

		</div>
		</div>
		</div>
		$}
	</script>

	<script type="text/template" id="account-template">
		{$
		<div id="account-inner">
		<div class="widget-box">
		<div class="widget-title">
		<h5>商户启用</h5>
		</div>
		<div class="widget-content">
		<div class="row">
		<div class="col-sm-7 col-md-7 col-lg-7" style="padding-top:16px">

		截止日期:<span id="expdate-span">{%expdate%}</span>
		</div>
		<div class="col-sm-5 col-md-5 col-lg-5">
		<div class="input-group input-group-sm pull-right">
		<span class="input-group-btn">
		<button class="btn btn-dark-green btn-sm" onclick="chargeconfirm({%sid%});">续费</button>
		</span>
		<input type="text" class="form-control" id="charge-input">
		<span class="input-group-btn">
		<a href="#" class="btn">个月</a>
		</span>
		</div>
		</div>
		</div>
		</div>
		</div>

		<div class="widget-box">
		<div class="widget-title">
		<h5>店铺LOGO上传</h5>
		</div>
		<div class="widget-content">
		<div class="row">
		<div class="col-xs-7"><img id="currentlogo" src="{%slogo%}" width="100" height="100" style="border:grey solid"/></div>

		<div>
		<input id="fileupload" title="选择一个LOGO" type="file" name="pic" data-url="/shops/updatelogo/{%sid%}" multiple></br>
		<span class="logospan">logo应该为透明png</span></br>
		<span class="logospan">100x100像素</span></br>
		<span class="logospan">小于100K</span>
		</div>
		</div>
		</div>

		</div>

		<div class="widget-box">
		<div class="widget-title">
		<h5>OEM信息(点击修改)</h5>
		</div>
		<div class="widget-content">
		<div class="row">
		<div class="col-xs-3">
		<b>公司名称:</b></div> <div id="oemname" class="col-xs-9">{%sname%}</div>
		</div>
		</br>
		<div class="row">
		<div class="col-xs-3"><b>公司网址:</b></div> <div id="oemurl" class="col-xs-9">{%surl%}</div></div>

		</div>

		</div>
		<div class="row">
		<div class="col-sm-12 col-md-12 col-lg-12	"><button class="btn btn-dark-green pull-right" onclick="$('#account-dialog').dialog('close');">确定</button></div>
		</div>
		</div>
		$}
	</script>

</html>
